!function(A){if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";var t,e;function o(){this.fontFamily="fjs"+(999999*Math.random()|0)}!function(A){try{new Uint8Array(1);return}catch(A){}function t(A,t){return this.slice(A,t)}function e(A,t){var e,o=A.length;for(arguments.length<2&&(t=0),e=0;e<o;++e,++t)this[t]=255&A[e]}function o(A){var o,r;if("number"==typeof A)for(o=new Array(A),r=0;r<A;++r)o[r]=0;else o=A.slice(0);return o.subarray=t,o.buffer=o,o.byteLength=o.length,o.set=e,"object"==typeof A&&A.buffer&&(o.buffer=A.buffer),o}A.Uint8Array=o,A.Uint32Array=o,A.Int32Array=o}(A),(t=A).opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||(e=t.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:e})),A.btoa||(A.btoa=function(A){var t,e,o,r,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,a=0,f="",l=[];if(!A)return A;do{t=(n=A.charCodeAt(s++)<<16|A.charCodeAt(s++)<<8|A.charCodeAt(s++))>>18&63,e=n>>12&63,o=n>>6&63,r=63&n,l[a++]=i.charAt(t)+i.charAt(e)+i.charAt(o)+i.charAt(r)}while(s<A.length);f=l.join("");var d=A.length%3;return(d?f.slice(0,d-3):f)+"===".slice(d||3)}),o.prototype.url="",o.prototype.format="",o.prototype.data="",o.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",o.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},o.prototype.systemfont=!1,o.prototype.loaded=!1,o.prototype.onload=function(){},o.prototype.onerror=function(){},o.prototype.canvas=!1,o.prototype.context=!1,o.prototype.validate=function(A,t,e,o,r){!1!==r&&r<0?this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."):getComputedStyle(A,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(t),document.body.removeChild(A),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout(function(){o.validate(A,t,e,o,!1!==r&&r-50)},1e3))},o.prototype.ondownloaded=function(){var A=this,t=function(A){return String.fromCharCode(A)},e=function(A){if(A<256)return t(0)+t(A);var e=255&A;return t(A>>8)+t(e)},o=function(A,t){return 256*A+t},r=function(A,t){var e,o=A>>7==1;return e=256*(A&=127)+t,o?e-32768:e},n=function(A,t,e,o){return 16777216*A+65536*t+256*e+o},i=function(t){A.onerror(t)},s=t(0)+t(1)+t(0)+t(0),a=this.data,f=t(a[0])+t(a[1])+t(a[2])+t(a[3]),l=f===s,d=!l&&"OTTO"===f;if(l)this.format="truetype";else{if(!d)return void i("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var u,c,h=o(a[4],a[5]),p=12+16*h,y={};for(u=12;u<p;u+=16)c=t(a[u])+t(a[u+1])+t(a[u+2])+t(a[u+3]),y[c]={name:c,checksum:n(a[u+4],a[u+5],a[u+6],a[u+7]),offset:n(a[u+8],a[u+9],a[u+10],a[u+11]),length:n(a[u+12],a[u+13],a[u+14],a[u+15])};var m=function(A){return y[A]?A:(i("Error: font is missing the required OpenType '"+A+"' table."),!1)};if(!1!==(c=m("head"))){u=y[c].offset,y[c].version=""+a[u]+a[u+1]+a[u+2]+a[u+3];var v=o(a[u+18],a[u+19]);if(this.metrics.quadsize=v,!1!==(c=m("hhea"))&&(u=y[c].offset,y[c].version=""+a[u]+a[u+1]+a[u+2]+a[u+3],this.metrics.ascent=r(a[u+4],a[u+5])/v,this.metrics.descent=r(a[u+6],a[u+7])/v,this.metrics.leading=r(a[u+8],a[u+9])/v,!1!==(c=m("OS/2"))&&(u=y[c].offset,y[c].version=""+a[u]+a[u+1],this.metrics.weightclass=o(a[u+4],a[u+5]),!1!==(c=m("cmap"))))){u=y[c].offset,y[c].version=""+a[u]+a[u+1],h=o(a[u+2],a[u+3]);for(var b,g,w,x,C=!1,E=0;E<h;E++)g=o(a[b=u+4+8*E],a[b+1]),w=o(a[b+2],a[b+3]),x=n(a[b+4],a[b+5],a[b+6],a[b+7]),3===g&&1===w&&(C=x);var B="A";if(!1!==C&&4===(f=o(a[u+=C],a[u+1]))){for(var T=u+14,F=u+14+2*(o(a[u+6],a[u+7])/2),S=!1;T<F&&(S=o(a[T],a[T+1]),-1!==[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(S));T+=2)S=!1;if(0!=S){B=String.fromCharCode(S);var q=(65536-(S-1))%65536,M=t(0)+e(S)+e(65535)+e(0)+e(S)+e(65535)+e(q)+e(1),H=btoa(M);this.base64=this.base64.substring(0,380)+H+this.base64.substring(380+H.length)}}this.bootstrapValidation(B,!1)}}},o.prototype.bootstrapValidation=function(A,t){var e=this.fontFamily+" testfont",o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="@font-face {\n  font-family: '"+e+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(o);var r=!1;this.systemfont||(r=this.toStyleNode(),document.head.appendChild(r));var n=document.createElement("p");if(n.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",n.style.fontFamily="'"+this.fontFamily+"', '"+e+"'",n.innerHTML=A+A+A+A+A+A+A+A+A+A,document.body.appendChild(n),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var i=this.systemfont?1e3:this.metrics.quadsize,s=document.createElement("canvas");s.width=i,s.height=i,this.canvas=s;var a=s.getContext("2d");a.font="1em '"+this.fontFamily+"'",a.fillStyle="white",a.fillRect(-1,-1,i+2,i+2),a.fillStyle="black",a.fillText("test text",50,i/2),this.context=a;var f=this;setTimeout(function(){f.validate(n,o,r,f,t)},50)}},o.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},o.prototype.loadFont=function(){var A=this;if(-1!==this.url.indexOf(".")){var t=new XMLHttpRequest;t.open("GET",A.url,!0),t.responseType="arraybuffer",t.onload=function(e){var o=t.response;o?(A.data=new Uint8Array(o),A.ondownloaded()):A.onerror("Error downloading font resource from "+A.url)},t.onerror=function(t){A.onerror("Error downloading font resource from "+A.url)},t.send(null)}else setTimeout(function(){A.processSystemFont()},10)},o.prototype.styleNode=!1,o.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css";var A=this.url.replace(".ttf",".eot"),t="@font-face {\n";return t+="  font-family: '"+this.fontFamily+"';\n",t+="  src: url('"+A+"') format(eot), url('"+this.url+"') format('"+this.format+"');\n",t+="}",this.styleNode.innerHTML=t,this.styleNode},o.prototype.measureText=function(A,t){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var e=this.context.measureText(A);e.fontsize=t,e.ascent=0,e.descent=0,e.bounds={minx:0,maxx:e.width,miny:0,maxy:0},e.height=0;var o=[];e.width,this.metrics.quadsize;o.push(A);var r,n=o.length;for(r=0;r<n;r++)this.measureSegment(o[r],t,e);return e},o.prototype.measureSegment=function(A,t,e){var o=document.createElement("div");o.style.position="absolute",o.style.opacity=0,o.style.font=t+"px '"+this.fontFamily+"'";for(o.innerHTML=A,v=1;v<10;v++)o.innerHTML+="<br/>"+A;document.body.appendChild(o),e.leading=1.2*t;var r,n,i=(r=o,n="height",document.defaultView.getComputedStyle(r,null).getPropertyValue(n));if((i=i.replace("px",""))>=10*t&&(e.leading=i/10|0),document.body.removeChild(o),/^\s*$/.test(A))return e;this.canvas;var s=this.context,a=this.systemfont?1e3:this.metrics.quadsize,f=a,l=a,d=a/2,u=(a-e.width)/2;u!==(0|u)&&(u|=0),s.fillStyle="white",s.fillRect(-50,-50,f+100,l+100),s.fillStyle="black",s.fillText(A,u,d);for(var c=e.width+50|0,h=4*t,p=u-25,y=d-h/2,m=s.getImageData(p,y,c,h).data,v=0,b=0,g=4*c,w=m.length,x=h/2;++v<w&&255===m[v];);var C=v/g|0;for(v=w-1;--v>0&&255===m[v];);var E=v/g|0;for(v=0,b=0;b<c&&255===m[v];)(v+=g)>=w&&(b++,v=v-w+4);var B=b,T=1;for(v=w-3,b=0;b<c&&255===m[v];)(v-=g)<0&&(b++,v=w-3-4*T++);var F=c-b;return e.ascent=x-C,e.descent=E-x,e.bounds={minx:B-25,maxx:F-25,miny:-e.descent,maxy:e.ascent},e.height=E-C+1,e},Object.defineProperty(o.prototype,"src",{set:function(A){this.url=A,this.loadFont()}}),"undefined"!=typeof define?define(function(){return o}):A.Font=o}(window);
